<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Scala Effekt</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Extensible algebraic effects with handlers" /><meta name="author" content="Jonathan Brachthäuser (@b-studios)" /><meta name="og:image" content="/scala-effekt/img/poster.png" /><meta name="og:title" content="Scala Effekt" /><meta name="og:site_name" content="Scala Effekt" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Extensible algebraic effects with handlers" /><meta name="twitter:image" content="/scala-effekt/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><meta name="kazari-dependencies" content="" /><meta name="kazari-resolvers" content="" /><link rel="icon" type="image/png" href="/scala-effekt/img/favicon.png" /><link rel="icon" type="image/png" sizes="16x16" href="/scala-effekt/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scala-effekt/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scala-effekt/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scala-effekt/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scala-effekt/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scala-effekt/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scala-effekt/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scala-effekt/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scala-effekt/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scala-effekt/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scala-effekt/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scala-effekt/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scala-effekt/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scala-effekt/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scala-effekt/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scala-effekt/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scala-effekt/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scala-effekt/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scala-effekt/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scala-effekt/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scala-effekt/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/scala-effekt/css/style.css" /><link rel="stylesheet" href="/scala-effekt/css/palette.css" /><link rel="stylesheet" href="/scala-effekt/css/codemirror.css" /><link rel="stylesheet" href="/scala-effekt/css/kazari-style.css" /><link rel="stylesheet" href="/scala-effekt/css/solarized-dark.css" /></head><body><header id="site-header"><div class="navbar-wrapper navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/scala-effekt/" class="brand"><div class="icon-wrapper"><span>Scala Effekt</span></div></a></div><nav class="text-right"><ul class=""><li><a href="https://github.com/b-studios/scala-effekt"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li></ul></nav></div></div><div class="jumbotron" style="background-image:url('/scala-effekt/img/jumbotron_pattern.png')"></div><div><ul class="horizontalNav">       <li><a class="" href="/scala-effekt/design.html">Design Decisions</a></li>  <li><a class="" href="/scala-effekt/first-effect.html">Getting Started</a></li>  <li><a class="" href="/scala-effekt/two-effects.html">Multiple Effects</a></li>  <li><a class=" active " href="/scala-effekt/multi-handlers.html">Multi Handlers</a></li> </ul></div></header><main id="site-main"><section class="use"><div class="container"><div id="content"><h1 id="handling-multiple-effects-at-once">Handling Multiple Effects at Once</h1>

<p>Sometimes the granularity of handlers does not coincide with the
granularity of effect signatures. For instance, we might want to
offer fine grained interfaces for reading and writing operations
but handle them together in one handler.</p>

<p>In this tutorial, we’ll see that in <strong>Effekt</strong> it is very natural to
define such combined handlers. Let’s start with defining the
effect signatures for <code class="highlighter-rouge">Reader</code> and <code class="highlighter-rouge">Writer</code>.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="nc">extends</span> <span class="nc">Eff</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">[</span><span class="kt">R</span><span class="o">]()</span><span class="k">:</span> <span class="kt">S</span> <span class="kt">@@</span> <span class="kt">R</span>
<span class="o">}</span>
<span class="k">trait</span> <span class="nc">Writer</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="nc">extends</span> <span class="nc">Eff</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">write</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">s</span><span class="k">:</span> <span class="kt">S</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="kt">@@</span> <span class="kt">R</span>
<span class="o">}</span>
</code></pre>
</div>

<p>(We omit the standard companion object definitions as seen in the
earlier tutorials.)</p>

<h2 id="defining-the-combined-handler">Defining the combined handler</h2>

<p>Since handlers of algebraic effects are just implementations of
the effect signature traits it is not surprising that one handler
might implement multiple of such signatures. Below, we define a
simple handler for <code class="highlighter-rouge">Reader</code> and <code class="highlighter-rouge">Writer</code> that uses a list to mediate
between the two effects.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">rwHandler</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="k">with</span> <span class="nc">Writer</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">State</span> <span class="o">=</span> <span class="nc">List</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span>
  <span class="k">type</span> <span class="kt">Out</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">[</span><span class="kt">S</span><span class="o">],</span> <span class="n">A</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">unit</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">read</span><span class="o">[</span><span class="kt">R</span><span class="o">]()</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">s</span> <span class="o">::</span> <span class="n">rest</span> <span class="k">=&gt;</span> <span class="n">resume</span> <span class="k">=&gt;</span> <span class="n">resume</span><span class="o">(</span><span class="n">s</span><span class="o">)(</span><span class="n">rest</span><span class="o">)</span>
    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="n">sys</span> <span class="n">error</span> <span class="s">"Not enough elements written to perform read"</span>
  <span class="o">}</span>
  <span class="k">def</span> <span class="n">write</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">s</span><span class="k">:</span> <span class="kt">S</span><span class="o">)</span> <span class="k">=</span> <span class="n">rest</span> <span class="k">=&gt;</span> <span class="n">resume</span> <span class="k">=&gt;</span> <span class="n">resume</span><span class="o">(())(</span><span class="n">s</span> <span class="o">::</span> <span class="n">rest</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="example-usage">Example usage</h2>

<p>To show the usage of the combined handler, let’s first define a
simple example program.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">example</span><span class="o">(</span><span class="k">implicit</span> <span class="n">r</span><span class="k">:</span> <span class="kt">Use</span><span class="o">[</span><span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span><span class="o">]],</span> <span class="n">w</span><span class="k">:</span> <span class="kt">Use</span><span class="o">[</span><span class="kt">Writer</span><span class="o">[</span><span class="kt">Int</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Control</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">write</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">write</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
    <span class="n">x</span> <span class="k">&lt;-</span> <span class="n">read</span><span class="o">()</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">write</span><span class="o">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>
    <span class="n">y</span> <span class="k">&lt;-</span> <span class="n">read</span><span class="o">()</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">y</span>
</code></pre>
</div>

<p>Handling the example with our combined handler, we get:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">handle</span><span class="o">(</span><span class="n">rwHandler</span><span class="o">[</span><span class="kt">Int</span><span class="o">])(</span><span class="nc">Nil</span><span class="o">)</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">rw</span> <span class="k">=&gt;</span> <span class="n">example</span> <span class="o">}.</span><span class="n">run</span><span class="o">()</span>
<span class="n">res0</span><span class="k">:</span> <span class="o">(</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="nc">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span><span class="mi">6</span><span class="o">)</span>
</code></pre>
</div>
</div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>Scala Effekt is designed and developed by <a href="http://b-studios.de" target="_blank">Jonathan Brachthäuser (@b-studios)</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/b-studios/scala-effekt"><span class="fa fa-github"></span>View on GitHub</a></p></div></div><div class="row"><div class="col-xs-6"><p>Website built with <a href="https://47deg.github.io/sbt-microsites/" target="_blank">Sbt-microsites</a> - © 2016 <a href="https://www.47deg.com/" target="_blank">47 Degrees</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/scala-effekt/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script></body></html>